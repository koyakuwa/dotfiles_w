# .bash_functionsの中身
echo '.zsh_functions'

# Functions for MSYS2 bash

# pacman for mingw32
function pinst()
{
    pacman -S "mingw-w64-i686-$1"
}
function puninst()
{
    pacman -Rs "mingw-w64-i686-$1"
}

# others
function snow()
{
    clear;while :;do echo $LINES $COLUMNS $(($RANDOM%$COLUMNS));sleep 0.1;done|gawk '{a[$3]=0;for(x in a) {o=a[x];a[x]=a[x]+1;printf "\033[%s;%sH ",o,x;printf "\033[%s;%sH*\033[0;0H",a[x],x;}}'
}

function matrix()
{
    echo -e "\e[1;40m" ; clear ; while :; do echo $LINES $COLUMNS $(( $RANDOM % $COLUMNS)) $(( $RANDOM % 72 )) ;sleep 0.05; done|gawk '{ letters="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()"; c=$4; letter=substr(letters,c,1);a[$3]=0;for (x in a) {o=a[x];a[x]=a[x]+1; printf "\033[%s;%sH\033[2;32m%s",o,x,letter; printf "\033[%s;%sH\033[1;37m%s\033[0;0H",a[x],x,letter;if (a[x] >= $1) { a[x]=0; } }}'
}

# peco 用のラッパー
function _pecowrap_exec() {
  eval "$@" > /tmp/cmd.log
  script -e -qc "winpty peco /tmp/cmd.log" /tmp/script.log
}

function _pecowrap_result() {
  local result="$(col -bx < /tmp/script.log | tr -d '\n' | sed 's/.*0m\(.*\)0K.*$/\1/g' | sed 's/0K//g')"
  echo "${result}"
}

function c() {
  local peco_dir=$1
  if [ ! -d $peco_dir ]; then
    echo "${peco_dir} is not directory!"
    return
  fi
  if [ "${peco_dir:${#peco_dir}-1:1}" != "/" ]; then
    peco_dir="${peco_dir}/"
  fi
  _pecowrap_exec "find ${peco_dir} -maxdepth 1 -type d | sort" || return
  cd $(_pecowrap_result)
}

# ペコのスクリプト
peco-src() {
    local selected
    selected="$(ghq list --full-path | peco --query="$LBUFFER")"
    if [ -n "$selected" ]; then
        BUFFER="builtin cd $selected"
        # zle accept-line
    fi
    zle reset-prompt
}
zle -N peco-src
bindkey '^]' peco-src